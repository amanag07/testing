<html>
    <head>
        <script src="https://hosted.paysafe.com/checkout/v2/paysafe.checkout.min.js"></script>
        <title>ROIIM ASSIGNMENT</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    </head>

 
    <body>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="#">ROIIM ASSIGNMENT</a>
            
          </nav>
          <div class="container">
              <div class="row">
                  <div class="col-md-8">
                      <form>
                          <div class="form-row">
                              <div class="form-group col-md-12">
                                <label for="email">Email</label>
                                <input required type="email" class="form-control" value="somgupta13@gmail.com" id="email">
                              </div>
                          </div>
                        <div class="form-row">
                          <div class="form-group col-md-6">
                            <label for="firstName">First Name</label>
                            <input required type="text" class="form-control" value="som" id="firstName">
                          </div>
                          <div class="form-group col-md-6">
                            <label for="lastName">Last Name</label>
                            <input required type="text" class="form-control" value="gupta" id="lastName">
                          </div>
                        </div>
                        <div class="form-group">
                          <label for="address">Address</label>
                          <input required type="text" class="form-control" id="address" value="1234 Main st" placeholder="1234 Main St">
                        </div>
                        <div class="form-group ">
                            <label for="phoneNum">Phone</label>
                            <input required type="number" class="form-control"  value="8085603914" id="phoneNum">
                            </select>
                         </div>
                        <div class="form-row">
                          <div class="form-group col-md-6">
                            <label for="city">City</label>
                            <input required type="text" class="form-control" value="Shivpuri" id="city">
                          </div>
                          <div class="form-group col-md-4">
                            <label for="zip">Zip</label>
                            <input required type="number" class="form-control" value="473551" id="zip">
                          </div>
                          <div class="form-group col-md-4">
                            <label for="amount">Amount</label>
                            <input required type="number" class="form-control" value="100" id="amount">
                            </select>
                          </div>
                          
                        </div>
                        
                        <button type="submit"  class="btn btn-primary">Pay Money</button>
                      </form>
                  </div>
              </div>
          </div>
    </body>

    <script>
        $(document).ready(function(){
			  $("button").click(function(event){
			  	event.preventDefault();
			    onClick()
			  });
        });
        async function onClick(){
            let email=document.getElementById("email").value;
            let firstName=document.getElementById("firstName").value;
            let lastName=document.getElementById("lastName").value;
            let phone=document.getElementById("phoneNum").value;
            //billing address
            let city=document.getElementById("city").value;
            let zip=document.getElementById("zip").value;
            let street=document.getElementById("address").value;
            var token
            //amount
            let amount=document.getElementById("amount").value;
            $.ajax({
                url: "http://ec2-18-211-62-45.compute-1.amazonaws.com:3000/token",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({'email': email,'phone':phone,'firstName':firstName})    
                , success: function(result){
                    token=result.token;
                // console.log(result);
                billingAddress={
                    city:city,
                    street:street,
                    zip:zip,
                    country:'US',
                    state:'CA'
                }
                customer={
                    firstName:firstName,
                    lastName:lastName,
                    email:email,
                    phone:phone,
                    dateOfBirth:{
                        day:1,
                        month:6,
                        year:1989
                    }
                }
                
                    function uuidv4() {
                    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                    });
                }
                // console.log(uuidv4());
                    checkout(token,billingAddress,customer,amount,uuidv4())
                }});
					
			}
        function checkout() {
            paysafe.checkout.setup("cHVibGljLTc3NTE6Qi1xYTItMC01ZjAzMWNiZS0wLTMwMmQwMjE1MDA4OTBlZjI2MjI5NjU2M2FjY2QxY2I0YWFiNzkwMzIzZDJmZDU3MGQzMDIxNDUxMGJjZGFjZGFhNGYwM2Y1OTQ3N2VlZjEzZjJhZjVhZDEzZTMwNDQ", {
                "currency": "USD",
                "amount": 10000,
                "locale": "en_US",
                "customer": {
                    "firstName": "John",
                    "lastName": "Dee",
                    "email": "johndee@paysafe.com",
                    "phone": "1234567890",
                    "dateOfBirth": {
                        "day": 1,
                        "month": 7,
                        "year": 1990
                    }
                },
                "billingAddress": {
                    "nickName": "John Dee",
                    "street": "20735 Stevens Creek Blvd",
                    "street2": "Montessori",
                    "city": "Cupertino",
                    "zip": "95014",
                    "country": "US",
                    "state": "CA"
                },
                "environment": "TEST",
                "merchantRefNum": "1559900597607",
                "canEditAmount": true,
                "merchantDescriptor": {   
                    "dynamicDescriptor": "XYZ",
                    "phone": "1234567890"
                    },
                "displayPaymentMethods":["skrill","card"],
                "paymentMethodDetails": {
                    "paysafecard": {
                        "consumerId": "1232323"
                    },
                    "paysafecash": {
                        "consumerId": "123456"
                    },
                    "sightline": {
                        "consumerId": "123456",
                        "SSN": "123456789",
                        "last4ssn": "6789",
                        "accountId":"1009688222"
                    },
                    "vippreferred":{
                        "consumerId": "550726575",
                        "accountId":"1679688456"
                    }
                }
            }, function(instance, error, result) {
                if (result && result.paymentHandleToken) {
                    console.log(result.paymentHandleToken);
                    // make AJAX call to Payments API
                } else {
                    console.error(error);
                    // Handle the error
                }
            }, function(stage, expired) {
                switch(stage) {
                    case "PAYMENT_HANDLE_NOT_CREATED": // Handle the scenario
                    case "PAYMENT_HANDLE_CREATED": // Handle the scenario
                    case "PAYMENT_HANDLE_REDIRECT": // Handle the scenario
                    case "PAYMENT_HANDLE_PAYABLE": // Handle the scenario
                    default: // Handle the scenario
                }
            });
        }
    </script>
</html>